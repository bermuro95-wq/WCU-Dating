<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodMate – Connect by Feelings</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8a2be2;
            --secondary: #ff69b4;
            --accent: #9370db;
            --light: #f8f4ff;
            --dark: #2d1b69;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --card-shadow: 0 10px 20px rgba(138, 43, 226, 0.15);
            --glow: 0 0 15px rgba(138, 43, 226, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #f8f4ff 100%);
            color: #333;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header & Navigation */
        header {
            background: var(--gradient);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 2rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: var(--glow);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary);
        }

        /* Hero Section */
        .hero {
            padding: 80px 0;
            text-align: center;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%238a2be2" fill-opacity="0.1" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,202.7C672,203,768,181,864,165.3C960,149,1056,139,1152,149.3C1248,160,1344,192,1392,208L1440,224L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>') no-repeat bottom;
            background-size: cover;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
            color: #555;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        /* Mood Selection */
        .mood-selection {
            padding: 60px 0;
            background: white;
            border-radius: 30px;
            margin: 30px auto;
            box-shadow: var(--card-shadow);
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.2rem;
            color: var(--dark);
        }

        .mood-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .mood-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
        }

        .mood-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
            border-color: var(--accent);
        }

        .mood-card.selected {
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .mood-emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .mood-name {
            font-weight: 600;
            color: var(--dark);
        }

        /* Chat Interface */
        .chat-container {
            display: none;
            max-width: 800px;
            margin: 30px auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .chat-header {
            background: var(--gradient);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            height: 400px;
            padding: 20px;
            overflow-y: auto;
            background: #f9f7ff;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.self {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 15px;
            border-radius: 18px;
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .message.self .message-content {
            background: var(--gradient);
            color: white;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 30px;
            outline: none;
            font-size: 1rem;
        }

        .chat-input button {
            margin-left: 10px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            transform: scale(1.05);
        }

        /* Dashboard */
        .dashboard {
            padding: 40px 0;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .dashboard-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .dashboard-card h3 {
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .active-users {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f0e6ff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Profile */
        .profile {
            padding: 40px 0;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
        }

        .profile-info h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .profile-info p {
            color: #666;
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #777;
        }

        /* About Section */
        .about-section {
            padding: 60px 0;
            background: white;
            border-radius: 30px;
            margin: 30px auto;
            box-shadow: var(--card-shadow);
        }

        .developer-info, .contact-info {
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
        }

        .info-item, .contact-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f7ff;
            border-radius: 10px;
        }

        .info-item h3, .contact-item h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .social-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            padding: 8px 15px;
            background: #f0e6ff;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .social-link:hover {
            background: var(--gradient);
            color: white;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 50px 0 20px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Authentication Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: white;
            padding: 10px 0;
            z-index: 1;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }

        .auth-form input, .auth-form select {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        .password-container {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 12px;
            cursor: pointer;
            color: #777;
        }

        .auth-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .auth-divider {
            text-align: center;
            margin: 15px 0;
            position: relative;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }

        .auth-divider span {
            background: white;
            padding: 0 15px;
            color: #777;
        }

        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: var(--success);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        /* Social Login Buttons */
        .social-btn {
            background: white;
            border: 2px solid #e0e0e0;
            color: #333;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .google-btn:hover {
            border-color: #DB4437;
            color: #DB4437;
        }

        .facebook-btn:hover {
            border-color: #4267B2;
            color: #4267B2;
        }

        /* Page Sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Login Face */
        .login-face {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .login-face img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* How It Works Modal */
        .how-it-works-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .how-it-works-content {
            background: white;
            border-radius: 25px;
            padding: 40px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .how-it-works-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .how-it-works-title {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .how-it-works-subtitle {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        .close-how-it-works {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #777;
            position: absolute;
            top: 20px;
            right: 20px;
            transition: color 0.3s ease;
            z-index: 1001;
        }

        .close-how-it-works:hover {
            color: var(--primary);
        }

        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .step {
            display: flex;
            gap: 25px;
            align-items: flex-start;
            padding: 25px;
            background: linear-gradient(135deg, #f9f7ff 0%, #f0e6ff 100%);
            border-radius: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid var(--primary);
        }

        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(138, 43, 226, 0.15);
        }

        .step-icon {
            background: var(--gradient);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .step-description {
            color: #555;
            line-height: 1.7;
            font-size: 1.05rem;
        }

        /* MoodMate Images */
        .moodmate-images {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .moodmate-image {
            width: 150px;
            height: 150px;
            border-radius: 20px;
            object-fit: cover;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
        }

        .moodmate-image:hover {
            transform: scale(1.05);
        }

        /* FIX: How It Works Button Visibility */
        #howItWorksBtn {
            transition: all 0.3s ease;
            outline: none;
            position: relative;
        }

        #howItWorksBtn:active,
        #howItWorksBtn.active {
            background: white !important;
            color: var(--primary) !important;
            transform: translateY(0) !important;
            border: 2px solid white !important;
        }

        #howItWorksBtn:hover {
            background: white;
            color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                gap: 10px;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .mood-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            /* Mobile modal fixes */
            .modal {
                padding: 10px;
                align-items: flex-start;
            }

            .modal-content {
                max-height: 85vh;
                padding: 20px;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .modal-header {
                position: relative;
                padding: 0;
            }

            .how-it-works-content {
                padding: 25px;
            }

            .how-it-works-title {
                font-size: 2rem;
            }

            .step {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .step-icon {
                align-self: center;
            }

            .moodmate-images {
                gap: 10px;
            }

            .moodmate-image {
                width: 120px;
                height: 120px;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 2rem;
            }

            .modal-content {
                padding: 15px;
            }

            .auth-form input, .auth-form select {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            .how-it-works-content {
                padding: 20px;
            }

            .how-it-works-title {
                font-size: 1.8rem;
            }

            .step {
                padding: 20px;
            }

            .step-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .step-title {
                font-size: 1.2rem;
            }

            .moodmate-image {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-heart"></i>
                    <span>MoodMate</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="connect">Connect</a></li>
                        <li><a href="#" class="nav-link" data-page="profile">Profile</a></li>
                        <li><a href="#" class="nav-link" data-page="about">About</a></li>
                    </ul>
                </nav>
                <div class="user-actions">
                    <button class="btn btn-outline" id="loginBtn">Log In</button>
                    <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Home Section -->
    <section class="page-section active" id="home">
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>Connect by Feelings</h1>
                <p>MoodMate is a social platform that connects you in real time based on your current mood. Find someone who understands how you feel right now.</p>
                
                <!-- MoodMate Images -->
                <div class="moodmate-images">
                    <img src="https://images.unsplash.com/photo-1579546929662-711aa81148cf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="Colorful emotions" class="moodmate-image">
                    <img src="https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="People connecting" class="moodmate-image">
                    <img src="https://images.unsplash.com/photo-1545235617-9465d2a55698?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="Happy faces" class="moodmate-image">
                </div>
                
                <div class="hero-buttons">
                    <button class="btn btn-primary" id="getStartedBtn">Get Started <i class="fas fa-arrow-right"></i></button>
                    <button class="btn btn-outline" id="howItWorksBtn">How It Works</button>
                </div>
            </div>
        </section>
    </section>

    <!-- Connect Section -->
    <section class="page-section" id="connect">
        <div class="mood-selection container">
            <h2 class="section-title">Connect with Others</h2>
            <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem;">Select your current mood and find someone who complements your feelings</p>
            <div class="mood-grid" id="connectMoodGrid">
                <!-- Mood cards will be populated dynamically -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="connectFindMatchBtn">Find My MoodMate</button>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <div>
                    <h3>Chat with <span id="chatPartnerName">...</span></h3>
                    <p id="connectionInfo">Connecting...</p>
                </div>
                <div>
                    <button class="btn btn-outline" id="endChatBtn">End Chat</button>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Chat messages will be populated dynamically -->
            </div>
            <div class="chat-input">
                <input type="text" placeholder="Type your message..." id="messageInput">
                <button id="sendMessageBtn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section class="page-section" id="profile">
        <div class="profile container">
            <h2 class="section-title">Your Profile</h2>
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <h2 id="profileName">...</h2>
                    <p id="profileBio">...</p>
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-value" id="connectionsCount">0</div>
                            <div class="stat-label">Connections</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="pointsCount">0</div>
                            <div class="stat-label">Kindness Points</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="activeDays">0</div>
                            <div class="stat-label">Days Active</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-history"></i> Recent Moods</h3>
                    <div id="recentMoods" style="margin-top: 15px;">
                        <!-- Recent moods will be populated dynamically -->
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-user-edit"></i> Edit Profile</h3>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" id="editProfileBtn">Edit Profile</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section (includes Contact) -->
    <section class="page-section" id="about">
        <div class="about-section container">
            <h2 class="section-title">About MoodMate</h2>
            <div class="developer-info">
                <h3 style="text-align: center; margin-bottom: 30px; color: var(--primary);">Developer Information</h3>
                
                <div class="info-item">
                    <h3>Developed by:</h3>
                    <p>Yoseph Abebe Ersedo</p>
                </div>
                
                <div class="info-item">
                    <h3>University:</h3>
                    <p>Wachemo University</p>
                </div>
                
                <div class="info-item">
                    <h3>Department:</h3>
                    <p>Information Systems</p>
                </div>
                
                <div class="info-item">
                    <h3>Year:</h3>
                    <p>2025</p>
                </div>
                
                <div class="info-item">
                    <h3>Email:</h3>
                    <p>jossyabebe92@gmail.com</p>
                </div>
                
                <div class="info-item">
                    <h3>About the App:</h3>
                    <p>MoodMate is a social platform designed to connect people based on their current emotional state. It helps users find someone who can relate to their feelings, providing emotional support and meaningful connections.</p>
                </div>
            </div>

            <!-- Contact Information inside About Section -->
            <div class="contact-info">
                <h3 style="text-align: center; margin: 40px 0 20px; color: var(--primary);">Contact Information</h3>
                <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem;">Have questions or concerns? Feel free to reach out to us:</p>
                
                <div class="contact-item">
                    <h3>Phone:</h3>
                    <p>09-17-33-21-99</p>
                </div>
                
                <div class="contact-item">
                    <h3>Email:</h3>
                    <p>jossyabebe92@gmail.com</p>
                </div>
                
                <div class="contact-item">
                    <h3>Social Media:</h3>
                    <div class="social-links">
                        <a href="https://www.facebook.com/jossy.abebe.33" class="social-link" target="_blank">
                            <i class="fab fa-facebook"></i> Facebook
                        </a>
                        <a href="https://www.linkedin.com/in/jossy-abebe-69111734b?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" class="social-link" target="_blank">
                            <i class="fab fa-linkedin"></i> LinkedIn
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>MoodMate</h3>
                    <p>Connect by feelings. Find understanding. Share emotions.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="about">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#" class="nav-link" data-page="about">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <ul>
                        <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
                        <li><a href="https://www.facebook.com/jossy.abebe.33" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 MoodMate. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Authentication Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Sign Up</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="auth-form">
                <div id="signupFields">
                    <input type="text" placeholder="Full Name" id="fullName">
                    <select id="gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        
                    </select>
                    <input type="text" placeholder="Country" id="country">
                </div>
                <input type="email" placeholder="Email Address" id="email">
                
                <div class="password-container">
                    <input type="password" placeholder="Password" id="password">
                    <span class="toggle-password" id="togglePassword">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <div class="password-container" id="confirmPasswordContainer">
                    <input type="password" placeholder="Confirm Password" id="confirmPassword">
                    <span class="toggle-password" id="toggleConfirmPassword">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <div class="error-message" id="authError"></div>
                <div class="success-message" id="authSuccess"></div>
                <button class="btn btn-primary" style="width: 100%;" id="authActionBtn">Create Account</button>
                <div class="auth-divider">
                    <span>or continue with</span>
                </div>
                <div class="auth-options">
                    <button class="social-btn google-btn" id="googleSignIn">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook-btn" id="facebookSignIn">
                        <i class="fab fa-facebook"></i> Facebook
                    </button>
                </div>
                <div class="login-face" id="loginFace" style="display: none;">
                    <img id="userPhoto" src="" alt="User Photo">
                    <span id="userName">User Name</span>
                </div>
                <p style="text-align: center; margin-top: 20px;">
                    <span id="authSwitchText">Already have an account?</span> 
                    <a href="#" style="color: var(--primary);" id="switchAuthMode">Log In</a>
                </p>
            </div>
        </div>
    </div>

    <!-- How It Works Modal -->
    <div class="how-it-works-modal" id="howItWorksModal">
        <div class="how-it-works-content">
            <button class="close-how-it-works" id="closeHowItWorks">&times;</button>
            
            <div class="how-it-works-header">
                <h2 class="how-it-works-title">How MoodMate Works</h2>
                <p class="how-it-works-subtitle">A step-by-step guide to connecting with others through emotional intelligence</p>
            </div>
            
            <div class="steps-container">
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-smile"></i>
                    </div>
                    <div class="step-content">
                        <h3 class="step-title">Select Your Current Mood</h3>
                        <p class="step-description">Begin by choosing the mood that best describes how you feel right now. Whether you're happy, sad, anxious, excited, relaxed, or simply in need of someone to talk to, MoodMate provides a variety of emotional states to select from. This step helps the system understand your emotional energy and the kind of interaction you might need at the moment.</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="step-content">
                        <h3 class="step-title">Get Matched with Complementary Moods</h3>
                        <p class="step-description">Once your mood is selected, MoodMate uses an intelligent mood matching algorithm to find someone whose current emotional state complements yours. For instance, if you're feeling low, you might be matched with someone cheerful and encouraging, while if you're excited, you may connect with someone equally energetic or appreciative of that positivity. The goal is to balance emotions and create uplifting human connections.</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="step-content">
                        <h3 class="step-title">Start Meaningful Conversations</h3>
                        <p class="step-description">After being paired with your MoodMate, you can begin chatting right away. Use this opportunity to express yourself freelyshare your thoughts, feelings, or even small stories about your day. MoodMate encourages open and supportive dialogue where both people listen, empathize, and uplift one another. Every chat is a chance to form a genuine emotional connection.</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="step-content">
                        <h3 class="step-title">Earn Kindness Points</h3>
                        <p class="step-description">Each time you engage in a meaningful and respectful conversation, you earn Kindness Points. These points reflect the quality of your interactions showing empathy, offering comfort, or making someone smile all contribute to your score. Over time, you can use these points to unlock special rewards, badges, or recognition in the MoodMate community, celebrating emotional intelligence and compassion.</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="step-content">
                        <h3 class="step-title">Build Lasting Connections</h3>
                        <p class="step-description">MoodMate is more than just a chat app it's a platform to create authentic relationships built on shared emotions and mutual understanding. As you continue interacting with others who genuinely resonate with your feelings, you'll discover people who can become long-term friends or emotional supporters. Through small, daily conversations, MoodMate helps you build a network of kindness, empathy, and emotional harmony.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    
    
    
<script>
    // Firebase Configuration 
    const firebaseConfig = {
        apiKey: "AIzaSyArKVCDSqgQO65s7YAifLeU5xgPOWxmue8",
        authDomain: "moodmate-faf26.firebaseapp.com",
        projectId: "moodmate-faf26",
        storageBucket: "moodmate-faf26.firebasestorage.app",
        messagingSenderId: "39348859057",
        appId: "1:39348859057:web:c4be7b9212beb108613290",
        measurementId: "G-MJV8S14RB9"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Initialize Firebase Auth providers
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    const facebookProvider = new firebase.auth.FacebookAuthProvider();

    // DOM Elements
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const getStartedBtn = document.getElementById('getStartedBtn');
    const howItWorksBtn = document.getElementById('howItWorksBtn');
    const authModal = document.getElementById('authModal');
    const closeModal = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const switchAuthMode = document.getElementById('switchAuthMode');
    const authSwitchText = document.getElementById('authSwitchText');
    const authActionBtn = document.getElementById('authActionBtn');
    const signupFields = document.getElementById('signupFields');
    const authError = document.getElementById('authError');
    const authSuccess = document.getElementById('authSuccess');
    const googleSignIn = document.getElementById('googleSignIn');
    const facebookSignIn = document.getElementById('facebookSignIn');
    const connectFindMatchBtn = document.getElementById('connectFindMatchBtn');
    const chatContainer = document.getElementById('chatContainer');
    const endChatBtn = document.getElementById('endChatBtn');
    const sendMessageBtn = document.getElementById('sendMessageBtn');
    const messageInput = document.getElementById('messageInput');
    const chatMessages = document.getElementById('chatMessages');
    const chatPartnerName = document.getElementById('chatPartnerName');
    const connectionInfo = document.getElementById('connectionInfo');
    const connectMoodGrid = document.getElementById('connectMoodGrid');
    const profileName = document.getElementById('profileName');
    const profileBio = document.getElementById('profileBio');
    const profileAvatar = document.getElementById('profileAvatar');
    const connectionsCount = document.getElementById('connectionsCount');
    const pointsCount = document.getElementById('pointsCount');
    const activeDays = document.getElementById('activeDays');
    const recentMoods = document.getElementById('recentMoods');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const navLinks = document.querySelectorAll('.nav-link');
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const confirmPasswordContainer = document.getElementById('confirmPasswordContainer');
    const confirmPassword = document.getElementById('confirmPassword');
    const loginFace = document.getElementById('loginFace');
    const userPhoto = document.getElementById('userPhoto');
    const userName = document.getElementById('userName');
    const howItWorksModal = document.getElementById('howItWorksModal');
    const closeHowItWorks = document.getElementById('closeHowItWorks');

    // App State
    let currentUser = null;
    let selectedMood = null;
    let isLoginMode = false;
    let currentChatPartner = null;
    let userProfile = null;
    let previousPage = 'home';
    let currentChatId = null;

    // Mood Data
    const moods = [
        { emoji: "😊", name: "Happy", color: "#FFD700" },
        { emoji: "😔", name: "Sad", color: "#6495ED" },
        { emoji: "😴", name: "Tired", color: "#708090" },
        { emoji: "😡", name: "Angry", color: "#FF4500" },
        { emoji: "😌", name: "Calm", color: "#98FB98" },
        { emoji: "🤔", name: "Thoughtful", color: "#DDA0DD" },
        { emoji: "😰", name: "Anxious", color: "#FFA07A" },
        { emoji: "🎉", name: "Excited", color: "#FF69B4" }
    ];

    // Initialize the app
    function initApp() {
        populateConnectMoodGrid();
        setupEventListeners();
        setupNavigation();
        
        // Check auth state
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                console.log('User logged in:', user.uid);
                
                // Initialize user document with basic fields only
                initializeUserProfile(user);
                
            } else {
                console.log('No user logged in');
                if (currentUser) {
                    // Update user as offline when logging out
                    updateUserOfflineStatus();
                }
                currentUser = null;
                updateUIForGuest();
                showPage('home');
            }
        });
    }

    // Initialize user profile with error handling
    function initializeUserProfile(user) {
        db.collection('users').doc(user.uid).set({
            uid: user.uid,
            displayName: user.displayName || 'User',
            email: user.email,
            isOnline: true,
            lastActive: firebase.firestore.FieldValue.serverTimestamp(),
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            kindnessPoints: 0,
            connections: 0,
            activeDays: 1
        }, { merge: true }).then(() => {
            console.log('User profile initialized successfully');
            loadUserProfile(user.uid);
            updateUIForUser(user);
            showPage('home');
        }).catch(error => {
            console.error("Error initializing user profile:", error);
            // Still continue even if initialization fails
            loadUserProfile(user.uid);
            updateUIForUser(user);
            showPage('home');
        });
    }

    // Update user offline status
    function updateUserOfflineStatus() {
        db.collection('users').doc(currentUser.uid).update({
            isOnline: false
        }).catch(error => {
            console.error("Error updating offline status:", error);
        });
    }

// Setup navigation - FIXED VERSION
function setupNavigation() {
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const page = link.getAttribute('data-page');
            
            // About page is always accessible
            if (page === 'about') {
                showPage('about');
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                return;
            }
            
            // Other pages require login
            if (!currentUser) {
                openAuthModal(true);
                return;
            }
            
            showPage(page);
            
            // Update active nav link
            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
        });
    });
}

    // Show specific page
    function showPage(page) {
        document.querySelectorAll('.page-section').forEach(section => {
            section.classList.remove('active');
        });
        
        // About page is always accessible
        if (page === 'about') {
            document.getElementById(page).classList.add('active');
            return;
        }
        
        if (currentUser) {
            document.getElementById(page).classList.add('active');
        } else {
            // If not logged in, only show home page
            document.getElementById('home').classList.add('active');
        }
    }

    // Populate connect mood selection grid only
    function populateConnectMoodGrid() {
        connectMoodGrid.innerHTML = '';
        
        moods.forEach(mood => {
            const connectMoodCard = document.createElement('div');
            connectMoodCard.className = 'mood-card';
            connectMoodCard.innerHTML = `
                <div class="mood-emoji">${mood.emoji}</div>
                <div class="mood-name">${mood.name}</div>
            `;
            connectMoodCard.addEventListener('click', () => selectMood(mood, connectMoodCard));
            connectMoodGrid.appendChild(connectMoodCard);
        });
    }

    // Select a mood
    function selectMood(mood, card) {
        if (!currentUser) {
            openAuthModal(true);
            return;
        }
        
        document.querySelectorAll('.mood-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedMood = mood;
    }

    // Setup event listeners - FIXED CLOSE BUTTON
    function setupEventListeners() {
        // Authentication
        loginBtn.addEventListener('click', () => openAuthModal(true));
        signupBtn.addEventListener('click', () => openAuthModal(false));
        getStartedBtn.addEventListener('click', () => openAuthModal(false));
        howItWorksBtn.addEventListener('click', function() {
            // Add active class to show button is clicked
            this.classList.add('active');
            setTimeout(() => {
                this.classList.remove('active');
            }, 300);
            openHowItWorksModal();
        });
        closeModal.addEventListener('click', closeAuthModal);
        switchAuthMode.addEventListener('click', toggleAuthMode);
        authActionBtn.addEventListener('click', handleAuthAction);
        googleSignIn.addEventListener('click', signInWithGoogle);
        facebookSignIn.addEventListener('click', signInWithFacebook);
        
        // How It Works Modal - FIXED CLOSE BUTTON
        closeHowItWorks.addEventListener('click', closeHowItWorksModal);
        
        // Close modal when clicking outside
        howItWorksModal.addEventListener('click', (e) => {
            if (e.target === howItWorksModal) {
                closeHowItWorksModal();
            }
        });
        
        // Password visibility toggle
        togglePassword.addEventListener('click', togglePasswordVisibility);
        toggleConfirmPassword.addEventListener('click', toggleConfirmPasswordVisibility);
        
        // Chat
        connectFindMatchBtn.addEventListener('click', findMatch);
        endChatBtn.addEventListener('click', endChat);
        sendMessageBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // Profile
        editProfileBtn.addEventListener('click', openEditProfileModal);
    }

    // Open How It Works Modal
    function openHowItWorksModal() {
        howItWorksModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    // Close How It Works Modal - FIXED FUNCTION
    function closeHowItWorksModal() {
        howItWorksModal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // Toggle password visibility
    function togglePasswordVisibility() {
        const passwordInput = document.getElementById('password');
        const icon = togglePassword.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // Toggle confirm password visibility
    function toggleConfirmPasswordVisibility() {
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const icon = toggleConfirmPassword.querySelector('i');
        
        if (confirmPasswordInput.type === 'password') {
            confirmPasswordInput.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            confirmPasswordInput.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // Authentication functions
    function openAuthModal(isLogin) {
        isLoginMode = isLogin;
        modalTitle.textContent = isLogin ? 'Log In' : 'Sign Up';
        authActionBtn.textContent = isLogin ? 'Log In' : 'Create Account';
        authSwitchText.textContent = isLogin ? "Don't have an account?" : "Already have an account?";
        switchAuthMode.textContent = isLogin ? 'Sign Up' : 'Log In';
        signupFields.style.display = isLogin ? 'none' : 'block';
        confirmPasswordContainer.style.display = isLogin ? 'none' : 'block';
        authError.style.display = 'none';
        authSuccess.style.display = 'none';
        
        // Hide login face by default
        loginFace.style.display = 'none';
        
        authModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeAuthModal() {
        authModal.style.display = 'none';
        document.body.style.overflow = 'auto';
        // Clear form fields
        document.getElementById('fullName').value = '';
        document.getElementById('gender').value = '';
        document.getElementById('country').value = '';
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        document.getElementById('confirmPassword').value = '';
    }

    function toggleAuthMode(e) {
        e.preventDefault();
        openAuthModal(!isLoginMode);
    }

    function handleAuthAction() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
            showAuthError('Please fill in all fields');
            return;
        }
        
        if (!isLoginMode) {
            // Sign up validation
            const fullName = document.getElementById('fullName').value;
            const gender = document.getElementById('gender').value;
            const country = document.getElementById('country').value;
            const confirmPasswordValue = document.getElementById('confirmPassword').value;
            
            if (!fullName || !gender || !country) {
                showAuthError('Please fill in all fields');
                return;
            }
            
            if (password !== confirmPasswordValue) {
                showAuthError('Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Password should be at least 6 characters');
                return;
            }
        }
        
        if (isLoginMode) {
            // Login
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    showAuthSuccess('Login successful!');
                    setTimeout(closeAuthModal, 1000);
                })
                .catch((error) => {
                    showAuthError(error.message);
                });
        } else {
            // Sign up
            const fullName = document.getElementById('fullName').value;
            const gender = document.getElementById('gender').value;
            const country = document.getElementById('country').value;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    // Create user profile in Firestore
                    return db.collection('users').doc(user.uid).set({
                        uid: user.uid,
                        displayName: fullName,
                        email: email,
                        gender: gender,
                        country: country,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        kindnessPoints: 0,
                        connections: 0,
                        activeDays: 1,
                        lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                        isOnline: true
                    });
                })
                .then(() => {
                    showAuthSuccess('Account created successfully!');
                    setTimeout(closeAuthModal, 1000);
                })
                .catch((error) => {
                    showAuthError(error.message);
                });
        }
    }

    function signInWithGoogle() {
        auth.signInWithPopup(googleProvider)
            .then((result) => {
                // Check if user is new
                const user = result.user;
                const isNewUser = result.additionalUserInfo.isNewUser;
                
                if (isNewUser) {
                    // Create user profile for new Google user
                    return db.collection('users').doc(user.uid).set({
                        uid: user.uid,
                        displayName: user.displayName,
                        email: user.email,
                        photoURL: user.photoURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        kindnessPoints: 0,
                        connections: 0,
                        activeDays: 1,
                        lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                        isOnline: true
                    });
                }
            })
            .then(() => {
                showAuthSuccess('Signed in with Google successfully!');
                setTimeout(closeAuthModal, 1000);
            })
            .catch((error) => {
                showAuthError(error.message);
            });
    }

    function signInWithFacebook() {
        auth.signInWithPopup(facebookProvider)
            .then((result) => {
                // Check if user is new
                const user = result.user;
                const isNewUser = result.additionalUserInfo.isNewUser;
                
                if (isNewUser) {
                    // Create user profile for new Facebook user
                    return db.collection('users').doc(user.uid).set({
                        uid: user.uid,
                        displayName: user.displayName,
                        email: user.email,
                        photoURL: user.photoURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        kindnessPoints: 0,
                        connections: 0,
                        activeDays: 1,
                        lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                        isOnline: true
                    });
                }
            })
            .then(() => {
                showAuthSuccess('Signed in with Facebook successfully!');
                setTimeout(closeAuthModal, 1000);
            })
            .catch((error) => {
                showAuthError(error.message);
            });
    }

    function showAuthError(message) {
        authError.textContent = message;
        authError.style.display = 'block';
        authSuccess.style.display = 'none';
    }

    function showAuthSuccess(message) {
        authSuccess.textContent = message;
        authSuccess.style.display = 'block';
        authError.style.display = 'none';
    }

    // Update UI based on auth state
    function updateUIForUser(user) {
        loginBtn.textContent = 'Profile';
        signupBtn.textContent = 'Log Out';
        signupBtn.onclick = () => {
            auth.signOut().then(() => {
                // Reset UI after logout
                updateUIForGuest();
                showPage('home');
            });
        };
        
        // Show user info in login face if available
        if (user.photoURL) {
            userPhoto.src = user.photoURL;
            userName.textContent = user.displayName || 'User';
            loginFace.style.display = 'flex';
        }
    }

    function updateUIForGuest() {
        loginBtn.textContent = 'Log In';
        signupBtn.textContent = 'Sign Up';
        signupBtn.onclick = () => openAuthModal(false);
        chatContainer.style.display = 'none';
        loginFace.style.display = 'none';
        
        // Reset active nav links
        navLinks.forEach(l => l.classList.remove('active'));
        document.querySelector('.nav-link[data-page="home"]').classList.add('active');
    }

    // Load user profile from Firestore
    function loadUserProfile(uid) {
        db.collection('users').doc(uid).get()
            .then((doc) => {
                if (doc.exists) {
                    userProfile = doc.data();
                    updateProfileUI(userProfile);
                }
            })
            .catch((error) => {
                console.error("Error loading user profile:", error);
            });
    }

    // Update profile UI with user data
    function updateProfileUI(profile) {
        profileName.textContent = profile.displayName || 'User';
        profileBio.textContent = `${profile.gender || ''} • ${profile.country || ''}`;
        connectionsCount.textContent = profile.connections || 0;
        pointsCount.textContent = profile.kindnessPoints || 0;
        activeDays.textContent = profile.activeDays || 1;
        
        // Set avatar initial or photo
        if (profile.photoURL) {
            profileAvatar.innerHTML = `<img src="${profile.photoURL}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
        } else {
            const initial = profile.displayName ? profile.displayName.charAt(0).toUpperCase() : 'U';
            profileAvatar.innerHTML = initial;
        }
    }

// REAL MATCHING FUNCTION - Connects to actual users
function findMatch() {
    if (!currentUser) {
        openAuthModal(true);
        return;
    }
    
    if (!selectedMood) {
        alert('Please select a mood first!');
        return;
    }
    
    // Get today's date in YYYY-MM-DD format for matching
    const today = new Date().toISOString().split('T')[0];
    
    console.log(`Looking for REAL match: ${selectedMood.name} on ${today}`);
    
    // Show loading state
    const originalText = connectFindMatchBtn.textContent;
    connectFindMatchBtn.textContent = 'Searching for real users...';
    connectFindMatchBtn.disabled = true;
    
    // First, update current user's mood and make them available
    db.collection('users').doc(currentUser.uid).update({
        currentMood: selectedMood.name,
        moodDate: today,
        isOnline: true,
        lastMoodUpdate: firebase.firestore.FieldValue.serverTimestamp(),
        lastActive: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        console.log('User mood updated, searching for real matches...');
        
        // REAL QUERY: Find users with same mood today
        db.collection('users')
            .where('currentMood', '==', selectedMood.name)
            .where('moodDate', '==', today)
            .where('isOnline', '==', true)
            .get()
            .then((snapshot) => {
                connectFindMatchBtn.textContent = originalText;
                connectFindMatchBtn.disabled = false;
                
                const potentialMatches = [];
                
                snapshot.forEach(doc => {
                    const userData = doc.data();
                    // Exclude current user and ensure data is valid
                    if (userData.uid !== currentUser.uid &&
                        userData.displayName &&
                        userData.currentMood === selectedMood.name) {
                        potentialMatches.push({
                            id: doc.id,
                            ...userData
                        });
                    }
                });
                
                if (potentialMatches.length > 0) {
                    // Select the best match (most recent or random)
                    const randomIndex = Math.floor(Math.random() * potentialMatches.length);
                    currentChatPartner = potentialMatches[randomIndex];
                    
                    console.log('REAL USER MATCH FOUND:', currentChatPartner);
                    alert(`🎉 Found a real user feeling ${selectedMood.name}! Starting chat...`);
                    startRealChatSession();
                } else {
                    // No real matches found
                    console.log('No real users found for mood:', selectedMood.name);
                    
                    // Check if we can find any online users at all
                    db.collection('users')
                        .where('isOnline', '==', true)
                        .limit(10)
                        .get()
                        .then((onlineSnapshot) => {
                            const onlineUsers = [];
                            onlineSnapshot.forEach(doc => {
                                const userData = doc.data();
                                if (userData.uid !== currentUser.uid && userData.displayName) {
                                    onlineUsers.push(userData);
                                }
                            });
                            
                            if (onlineUsers.length > 0) {
                                alert(`No one is feeling ${selectedMood.name} right now, but there are ${onlineUsers.length} users online. Try a different mood or check back later!`);
                            } else {
                                alert(`No other users are online right now. You're the first one! Try again in a few minutes.`);
                            }
                        })
                        .catch((error) => {
                            alert(`No one is feeling ${selectedMood.name} today. Try again later or select a different mood!`);
                        });
                }
            })
            .catch((error) => {
                console.error("Error in real match query:", error);
                connectFindMatchBtn.textContent = originalText;
                connectFindMatchBtn.disabled = false;
                
                // If query fails due to indexes, use alternative approach
                if (error.code === 'failed-precondition') {
                    alert('⚠️ Matching system is setting up... Please wait a moment and try again.');
                    console.log('Firestore indexes are being built. This is normal for new queries.');
                } else {
                    useAlternativeMatching();
                }
            });
    }).catch((error) => {
        console.error("Error updating user mood:", error);
        connectFindMatchBtn.textContent = originalText;
        connectFindMatchBtn.disabled = false;
        alert('Error updating your mood. Please try again.');
    });
}
    
    
    
    
    
// Alternative matching when complex queries fail
function useAlternativeMatching() {
    console.log('Using alternative matching approach...');
    
    // Get all users and filter manually (less efficient but works without indexes)
    db.collection('users').get()
        .then((snapshot) => {
            const today = new Date().toISOString().split('T')[0];
            const potentialMatches = [];
            
            snapshot.forEach(doc => {
                const userData = doc.data();
                // Manual filtering for same mood, same day, online, not current user
                if (userData.uid !== currentUser.uid &&
                    userData.currentMood === selectedMood.name &&
                    userData.moodDate === today &&
                    userData.isOnline === true) {
                    potentialMatches.push({
                        id: doc.id,
                        ...userData
                    });
                }
            });
            
            if (potentialMatches.length > 0) {
                const randomIndex = Math.floor(Math.random() * potentialMatches.length);
                currentChatPartner = potentialMatches[randomIndex];
                
                console.log('REAL USER FOUND via alternative method:', currentChatPartner);
                alert(`🎉 Found ${currentChatPartner.displayName} who is also feeling ${selectedMood.name}!`);
                startRealChatSession();
            } else {
                alert(`No one else is feeling ${selectedMood.name} right now. Try a different mood or check back later!`);
            }
        })
        .catch((error) => {
            console.error("Error in alternative matching:", error);
            alert('No users available right now. Please try again later.');
        });
}

// REAL CHAT SESSION - No demo
function startRealChatSession() {
    if (!currentChatPartner) {
        alert('No chat partner selected');
        return;
    }
    
    // Create a unique chat ID based on both user IDs
    const chatId = [currentUser.uid, currentChatPartner.id].sort().join('_');
    
    console.log('Starting REAL chat session:', chatId);
    
    // Create chat session in Firestore
    db.collection('chats').doc(chatId).set({
        participants: [currentUser.uid, currentChatPartner.id],
        participantNames: [currentUser.displayName || 'You', currentChatPartner.displayName || 'Anonymous'],
        participantMoods: [selectedMood.name, currentChatPartner.currentMood],
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        mood: selectedMood.name,
        isActive: true,
        lastActivity: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge: true }).then(() => {
        currentChatId = chatId;
        setupRealChatListener(chatId);
        showRealChatInterface();
        
        // Send automatic welcome message
        setTimeout(() => {
            sendAutoWelcomeMessage();
        }, 1000);
        
    }).catch((error) => {
        console.error("Error creating real chat session:", error);
        alert('Error starting chat. Please try again.');
    });
}

// REAL CHAT LISTENER - Listens for actual messages
function setupRealChatListener(chatId) {
    // Clear any existing listener
    if (window.chatListener) {
        window.chatListener();
    }
    
    console.log('Setting up REAL chat listener for:', chatId);
    
    window.chatListener = db.collection('chats').doc(chatId).collection('messages')
        .orderBy('timestamp', 'asc')
        .onSnapshot((snapshot) => {
            chatMessages.innerHTML = '';
            snapshot.forEach((doc) => {
                const message = doc.data();
                const isSelf = message.senderId === currentUser.uid;
                addMessageToChat(isSelf ? 'self' : 'partner', message.text);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }, (error) => {
            console.error("Real chat listener error:", error);
        });
}

// Show real chat interface
function showRealChatInterface() {
    // Show chat UI
    chatContainer.style.display = 'block';
    chatPartnerName.textContent = currentChatPartner.displayName || 'MoodMate User';
    connectionInfo.textContent = `Both feeling: ${selectedMood.name} • Connected today`;
    
    // Clear previous messages
    chatMessages.innerHTML = '';
    
    // Add welcome message
    addMessageToChat('system', `🎉 Connected with ${currentChatPartner.displayName}!`);
    addMessageToChat('system', `You're both feeling ${selectedMood.name.toLowerCase()} today. Start chatting!`);
    
    // Scroll to chat
    chatContainer.scrollIntoView({ behavior: 'smooth' });
    
    console.log('REAL chat interface shown');
}

// Send automatic welcome message in real chat
function sendAutoWelcomeMessage() {
    const welcomeMessages = {
        'Happy': `Hey! I'm feeling happy too! What's making your day great? 😊`,
        'Sad': `I understand how you feel. Want to talk about what's going on? 💜`,
        'Calm': `Nice to meet another calm soul. How's your day going? ☮️`,
        'Excited': `Wow, I'm excited too! What's got you feeling this way? 🎉`,
        'Thoughtful': `Interesting, I've been in a thoughtful mood as well. What's on your mind? 🤔`,
        'Anxious': `I get anxious too sometimes. Want to share what's bothering you? 🫂`,
        'Tired': `I'm feeling tired as well. Long day? Let's chat and relax 😴`,
        'Angry': `I understand the frustration. Want to talk it out? 🔥`
    };
    
    const autoMessage = welcomeMessages[selectedMood.name] || `Hi! I see we're both feeling ${selectedMood.name.toLowerCase()} today. How are you doing?`;
    
    // Add partner's auto message to chat
    addMessageToChat('partner', autoMessage);
}
    
    
    
    

    // Fallback function if Firestore queries fail
    function createFallbackMatch() {
        console.log('Using fallback matching system');
        
        // Create a demo partner (this is temporary until Firestore rules are fixed)
        currentChatPartner = {
            id: 'demo-partner',
            displayName: 'MoodMate User',
            currentMood: selectedMood.name,
            isOnline: true
        };
        
        startChatSession();
    }

    // Enhanced chat session start
    function startChatSession() {
        if (!currentChatPartner) {
            alert('No chat partner selected');
            return;
        }
        
        // Create a unique chat ID
        const chatId = currentChatPartner.id === 'demo-partner' 
            ? `demo_${Date.now()}`
            : [currentUser.uid, currentChatPartner.id].sort().join('_');
        
        // For demo partners, don't save to Firestore
        if (currentChatPartner.id === 'demo-partner') {
            setupDemoChat(chatId);
            return;
        }
        
        db.collection('chats').doc(chatId).set({
            participants: [currentUser.uid, currentChatPartner.id],
            participantNames: [currentUser.displayName || 'You', currentChatPartner.displayName || 'Anonymous'],
            participantMoods: [selectedMood.name, currentChatPartner.currentMood],
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            mood: selectedMood.name,
            isActive: true,
            lastActivity: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true }).then(() => {
            currentChatId = chatId;
            setupChatListener(chatId);
            showChatInterface();
        }).catch((error) => {
            console.error("Error starting chat:", error);
            // Fallback to demo chat if Firestore fails
            setupDemoChat(`fallback_${Date.now()}`);
        });
    }

    // Setup demo chat (when Firestore is not available)
    function setupDemoChat(chatId) {
        currentChatId = chatId;
        showChatInterface();
        
        // Add welcome messages for demo
        setTimeout(() => {
            addMessageToChat('partner', `Hi there! I see we're both feeling ${selectedMood.name.toLowerCase()} today. How are you doing?`);
        }, 1000);
    }

    // Show chat interface
    function showChatInterface() {
        // Show chat UI
        chatContainer.style.display = 'block';
        chatPartnerName.textContent = currentChatPartner.displayName || 'MoodMate';
        connectionInfo.textContent = `Both feeling: ${selectedMood.name} • Connected today`;
        
        // Clear previous messages
        chatMessages.innerHTML = '';
        
        // Add welcome message
        addMessageToChat('system', `You've been connected with ${currentChatPartner.displayName || 'a MoodMate'}! You're both feeling ${selectedMood.name.toLowerCase()} today.`);
        addMessageToChat('system', `This is a safe space to share how you're feeling. Start the conversation!`);
        
        // Scroll to chat
        chatContainer.scrollIntoView({ behavior: 'smooth' });
        
        console.log('Chat session started:', currentChatId);
    }

    // Enhanced chat listener
    function setupChatListener(chatId) {
        // Clear any existing listener
        if (window.chatListener) {
            window.chatListener();
        }
        
        window.chatListener = db.collection('chats').doc(chatId).collection('messages')
            .orderBy('timestamp', 'asc')
            .onSnapshot((snapshot) => {
                chatMessages.innerHTML = '';
                snapshot.forEach((doc) => {
                    const message = doc.data();
                    const isSelf = message.senderId === currentUser.uid;
                    addMessageToChat(isSelf ? 'self' : 'partner', message.text);
                });
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, (error) => {
                console.error("Chat listener error:", error);
            });
    }

    // Add a message to the chat
    function addMessageToChat(sender, message) {
        const messageElement = document.createElement('div');
        
        if (sender === 'system') {
            messageElement.className = 'message system';
            messageElement.innerHTML = `
                <div class="message-avatar">MM</div>
                <div class="message-content" style="background: #e0e0e0; color: #555;">${message}</div>
            `;
        } else if (sender === 'self') {
            messageElement.className = 'message self';
            messageElement.innerHTML = `
                <div class="message-avatar">${currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : 'Y'}</div>
                <div class="message-content">${message}</div>
            `;
        } else {
            messageElement.className = 'message';
            messageElement.innerHTML = `
                <div class="message-avatar">${currentChatPartner.displayName ? currentChatPartner.displayName.charAt(0).toUpperCase() : 'P'}</div>
                <div class="message-content">${message}</div>
            `;
        }
        
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    
// REAL send message function - sends to actual Firestore
function sendMessage() {
    const message = messageInput.value.trim();
    if (message === '' || !currentChatId) return;
    
    // Add user message to UI immediately
    addMessageToChat('self', message);
    messageInput.value = '';
    
    // Save message to Firestore for REAL chat
    db.collection('chats').doc(currentChatId).collection('messages').add({
        text: message,
        senderId: currentUser.uid,
        senderName: currentUser.displayName || 'Anonymous',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        // Update last activity
        db.collection('chats').doc(currentChatId).update({
            lastActivity: firebase.firestore.FieldValue.serverTimestamp()
        });
    }).catch((error) => {
        console.error("Error sending real message:", error);
        alert('Error sending message. Please try again.');
    });
}
    
    
    
    
// REAL end chat function
function endChat() {
    if (confirm('Are you sure you want to end this chat?')) {
        if (currentChatId) {
            // Update chat as inactive in Firestore
            db.collection('chats').doc(currentChatId).update({
                isActive: false,
                endedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // Remove chat listener
            if (window.chatListener) {
                window.chatListener();
                window.chatListener = null;
            }
        }
        
        chatContainer.style.display = 'none';
        currentChatId = null;
        currentChatPartner = null;
        
        // Update user stats for REAL connection
        if (userProfile) {
            userProfile.connections = (userProfile.connections || 0) + 1;
            userProfile.kindnessPoints = (userProfile.kindnessPoints || 0) + 5;
            updateProfileUI(userProfile);
            
            // Update in Firestore
            db.collection('users').doc(currentUser.uid).update({
                connections: firebase.firestore.FieldValue.increment(1),
                kindnessPoints: firebase.firestore.FieldValue.increment(5)
            }).catch(error => {
                console.error("Error updating user stats:", error);
            });
        }
        
        alert("Thanks for connecting with a real person who understands how you feel! 💜");
    }
}
    
    
    

    // Open edit profile modal (simplified for demo)
    function openEditProfileModal() {
        alert('Edit profile functionality would open here in a full implementation');
    }

    // Initialize the app when the page loads
    window.addEventListener('DOMContentLoaded', initApp);
</script>
    
    
        
</body>
</html>
